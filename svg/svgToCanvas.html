<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="../lib/html2canvas.min.js"></script>
</head>
<body>


<div id="imgBox">

    <svg height="480" version="1.1" width="640" xmlns="http://www.w3.org/2000/svg" style="overflow: hidden; position: relative;">
        <circle cx="390" cy="281" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="484" y="304" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="504" y="314" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">01F</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M390,281L484,314" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="135" cy="371" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="362" y="243" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="382" y="253" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">019</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M135,371L362,253" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="484" cy="337" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="312" y="392" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="332" y="402" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">020</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M484,337L312,402" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="430" cy="294" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="331" y="206" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="351" y="216" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">021</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M430,294L331,216" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="441" cy="362" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="341" y="252" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="361" y="262" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">022</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M441,362L341,262" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="561" cy="309" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="332" y="208" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="352" y="218" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">023</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M561,309L332,218" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="463" cy="377" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="378" y="283" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="398" y="293" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">024</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M463,377L378,293" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="517" cy="391" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="344" y="279" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="364" y="289" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">025</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M517,391L344,289" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="353" cy="366" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="367" y="261" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="387" y="271" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">026</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M353,366L367,271" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="470" cy="408" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="534" y="406" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="554" y="416" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">027</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M470,408L534,416" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="377" cy="230" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="363" y="271" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="383" y="281" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">028</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M377,230L363,281" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="565" cy="272" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="344" y="288" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="364" y="298" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">029</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M565,272L344,298" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="518" cy="376" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="380" y="288" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="400" y="298" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">030</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M518,376L380,298" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="594" cy="366" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="332" y="196" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="352" y="206" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">031</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M594,366L332,206" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="455" cy="386" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="375" y="244" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="395" y="254" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">032</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M455,386L375,254" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="314" cy="346" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="341" y="234" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="361" y="244" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">033</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M314,346L341,244" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="226" cy="377" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="347" y="234" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="367" y="244" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">034</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M226,377L347,244" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="471" cy="296" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="348" y="267" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="368" y="277" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">035</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M471,296L348,277" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
        <circle cx="65" cy="264" r="5" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></circle>
        <rect x="340" y="229" width="40" height="20" r="0" rx="0" ry="0" fill="#0000fe" stroke="#000" stroke-width="0" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></rect>
        <text x="360" y="239" text-anchor="middle" font="10px &quot;Arial&quot;" stroke="none" fill="#ffffff" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: middle; font: bold 15px Arial;" font-size="15px" font-weight="bold">
            <tspan dy="5.25" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">036</tspan>
        </text>
        <path fill="none" stroke="#0000fe" d="M65,264L340,239" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
    </svg>
</div>


<button id="down">down</button>

<script>


    const down = function (doc, base64data, fileName) {
        let link = doc.createElement('a');
        link.href = base64data;
        link.download = fileName;
        // var event = document.createEvent('MouseEvents');
        // event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
        // link.dispatchEvent(event);
        doc.body.appendChild(link);
        link.click();
        doc.body.removeChild(link);
    };

    const chartHeadTool = {
        methods: {
            //导出为图片
            downImg(eleId, success, error) {
                let obj = this.config.elements[eleId], comb = this.$refs['chart_' + eleId][0];
                let pixelRatio = 2; //下载的图片放大倍数
                let fileName = obj.cube.style.base.title || "未命名图表";
                let li = comb.$el.parentNode.parentNode.parentNode;
                let ul = li.parentNode;
                let lists = Array.from(ul.querySelectorAll('li'));
                let idx = lists.indexOf(li);
                let elem = null;
                let eleChart = ["Table", "ColTable", "EleTable", "EleTextCard", "EleRichText", "EleIframe"];
                if (eleChart.indexOf(obj.cube.config.chart.chartName) >= 0) {
                    if (obj.cube.config.chart.chartName === "Table" || obj.cube.config.chart.chartName === "ColTable") {
                        let canvas = comb.$el.querySelector("canvas");
                        // let ctx = canvas.getContext("2d")
                        // ctx.scale(2, 2);
                        //console.log(44);
                        let image = canvas.toDataURL();
                        let img = document.createElement("img");
                        img.setAttribute("src", image);
                        img.setAttribute("width", "100%");
                        img.setAttribute("height", "100%");
                        elem = img;
                        pixelRatio = 1;
                        //  let image = canvas.toDataURL('image/jpeg');
                        //  down(document, image, fileName);
                        // return;
                    }


                } else {
                    //let hasBMap = ["ChartMapArea","ChartMapScatter","ChartMapPath","ChartMapHeat"].indexOf(obj.cube.config.chart.chartName) >= 0;
                    let image = comb.chart.getDataURL({
                        type: "png",
                        pixelRatio: pixelRatio,
                        //backgroundColor: hasBMap?"transparent":"#fff"
                    });
                    let img = document.createElement("img");
                    img.setAttribute("src", image);
                    img.setAttribute("width", "100%");
                    img.setAttribute("height", "100%");
                    elem = img;
                }
                html2canvas(li, {


                    logging: false,
                    scale: pixelRatio,
                    useCORS: true,
                    onclone: function (ele) {
                        let canvas = ele.querySelector(".grid-main").querySelectorAll("li")[idx].querySelector("canvas");
                        //用elem 替换掉canvas
                        if (canvas) {
                            canvas.parentNode.replaceChild(elem, canvas);
                        }
                    },
                    ignoreElements: function (ele) {
                        if (ele.className === "tools" || ele.className === "bottom-icon-tool" || ele.className === "top-move-block") {
                            return true;
                        }
                    }
                }).then(function (canvas) {
                    let image = canvas.toDataURL('image/jpeg');
                    if (typeof success === "function") {
                        success({
                            success: true,
                            obj: image,
                            msg: ""
                        });
                    } else {
                        down(document, image, fileName);
                    }

                }, function () {
                    if (typeof error === "function") {
                        error({
                            success: false,
                            obj: null,
                            msg: "请求数据失败！"
                        });
                    }
                });
            },
            //导出Excel
            downExcel(temParam, eleId) {
                let obj = this.config.elements[eleId];
                let param = {
                    dataViewId: obj.dataViewId,
                    id: eleId,
                    selectCondition: this.downExcelCondition
                };
                _.merge(param, temParam);
                this.$http.post(zbi.config["zbiDataViewDesigner_exportExcel"], param, {
                    postType: "json",
                    responseType: 'arraybuffer'
                }).then((res) => {
                    if (res.data.msg) {
                        this.$msg.error(res.data.msg || "导出失败！");
                        return;
                    }
                    // if(res.data)
                    let fileName = decodeURI(res.headers['content-disposition'].split(";")[1].split("=")[1]);
                    let blob = new Blob([res.data], {type: "application/vnd.ms-excel"});
                    let objectUrl = URL.createObjectURL(blob);
                    //chrome
                    let link = document.createElement('a');
                    link.href = window.URL.createObjectURL(blob);
                    link.download = fileName;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    //火狐
                    //window.location.href = objectUrl;
                    window.URL.revokeObjectURL(objectUrl)
                }).catch((res) => {
                    this.$msg.error("导出失败！")
                });
            },
        }
    };

    let btn = document.getElementById("down");
    btn.addEventListener("click", function (e) {
        let dom = document.getElementById("imgBox");
        html2canvas(dom, {
            logging: false,
            scale: 1,
            useCORS: true,

        }).then(function (canvas) {
            let image = canvas.toDataURL('image/jpeg');

            down(document, image, "test");


        });
    });


</script>
</body>
</html>